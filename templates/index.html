<!DOCTYPE html>
<html>
  <head>
    <title>Terraform Autodeploy</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        position: relative;
      }
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -1;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(120, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 80%,
            rgba(120, 219, 255, 0.3) 0%,
            transparent 50%
          );
      }

      .main-container {
        display: flex;
        gap: 30px;
        max-width: 1400px;
        margin: 0 auto;
        align-items: flex-start;
        padding: 20px;
      }
      .left-panel {
        flex: 0 0 500px;
        min-width: 450px;
        max-width: 550px;
      }
      .right-panel {
        flex: 1;
        min-width: 500px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25),
          0 0 0 1px rgba(255, 255, 255, 0.2);
        padding: 30px;
        height: fit-content;
        position: sticky;
        top: 20px;
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 35px;
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15),
          0 0 0 1px rgba(255, 255, 255, 0.2);
        text-align: left;
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.18);
        position: relative;
        overflow: visible;
      }
      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        background-size: 200% 100%;
        animation: gradientShift 3s ease infinite;
      }
      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      /* Flashcards (flow layout so content can grow; only active is displayed) */
      .flash-card {
        display: none;
      }
      .flash-card.active {
        display: block;
        animation: cardIn 0.35s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      @keyframes cardIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: -10px 0 18px 0;
      }
      .card-title {
        font-size: 20px;
        font-weight: 700;
        color: #2d3748;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .kebab {
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 12px;
        padding: 8px;
      }
      .kebab:hover {
        background: rgba(102, 126, 234, 0.1);
      }
      .kebab:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
      }

      .menu {
        position: absolute;
        right: 14px;
        top: 48px;
        min-width: 200px;
        padding: 8px;
        background: #fff;
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 12px;
        box-shadow: 0 18px 45px -12px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 5;
      }
      .menu.open {
        display: block;
      }
      .menu button {
        width: 100%;
        background: transparent;
        border: none;
        text-align: left;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        color: #334155;
        cursor: pointer;
      }
      .menu button:hover {
        background: rgba(102, 126, 234, 0.08);
      }

      .deck-controls {
        display: flex;
        gap: 15px;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
        margin-bottom: 10px;
      }
      .deck-btn {
        padding: 18px 36px;
        font-size: 18px;
        font-weight: 700;
        border: none;
        border-radius: 20px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        cursor: pointer;
        box-shadow: 0 20px 40px -10px rgba(240, 147, 251, 0.8);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 180px;
        border: 3px solid rgba(255, 255, 255, 0.4);
      }
      .deck-btn:hover {
        transform: translateY(-4px);
        box-shadow: 0 25px 50px -10px rgba(240, 147, 251, 1);
        background: linear-gradient(135deg, #e879f9 0%, #ec4899 100%);
        border-color: rgba(255, 255, 255, 0.6);
      }

      /* Original UI styles */
      h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #1a202c;
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
      }
      h2 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2d3748;
        text-align: center;
        position: relative;
        padding-bottom: 10px;
      }
      h2::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 2px;
      }

      input[type="text"],
      select,
      textarea {
        width: 100%;
        padding: 16px 20px;
        margin-bottom: 20px;
        border: 2px solid rgba(102, 126, 234, 0.1);
        border-radius: 16px;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.8);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
      }
      input[type="text"]:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        background: rgba(255, 255, 255, 0.95);
        transform: translateY(-2px);
      }
      input[type="file"] {
        width: 100%;
        padding: 16px 20px;
        margin-bottom: 20px;
        border: 2px dashed rgba(102, 126, 234, 0.3);
        border-radius: 16px;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: 0.3s;
      }
      input[type="file"]:hover {
        border-color: #667eea;
        background: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
      }

      /* Larger textarea for the image section */
      .large-textarea {
        min-height: 140px;
      }

      button {
        padding: 16px 32px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 16px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        cursor: pointer;
        margin-top: 10px;
        width: 100%;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 10px 25px -10px rgba(102, 126, 234, 0.4);
        position: relative;
        overflow: hidden;
      }
      button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }
      button:hover::before {
        left: 100%;
      }
      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 20px 40px -15px rgba(102, 126, 234, 0.5);
        background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      }

      a {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
        transition: 0.2s;
        position: relative;
      }
      a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -2px;
        left: 0;
        background: linear-gradient(90deg, #667eea, #764ba2);
        transition: width 0.3s;
      }
      a:hover::after {
        width: 100%;
      }
      a:hover {
        color: #5a67d8;
      }

      p {
        margin-top: 20px;
        font-size: 16px;
        line-height: 1.6;
        color: #4a5568;
      }
      .response-box {
        margin: 25px 0;
        padding: 20px 25px;
        border-radius: 20px;
        word-wrap: break-word;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: visible;
      }

      /* Spacious “Quick Deploy” area that always fits */
      .quick-deploy {
        margin-top: 16px;
        padding: 14px;
        border-radius: 14px;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.06) 0%,
          rgba(118, 75, 162, 0.06) 100%
        );
        border: 1px solid rgba(102, 126, 234, 0.15);
      }
      .quick-deploy form {
        display: inline;
      }
      .inline-button {
        width: auto;
        display: inline-block;
        margin: 6px 0 0 0;
        padding: 10px 18px;
        font-size: 14px;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        box-shadow: 0 6px 20px -8px rgba(72, 187, 120, 0.4);
        border: none;
        border-radius: 12px;
        color: #fff;
      }

      .preview-title {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 25px;
        color: #2d3748;
        text-align: center;
        border-bottom: 3px solid transparent;
        background: linear-gradient(white, white),
          linear-gradient(90deg, #667eea, #764ba2);
        background-clip: padding-box, border-box;
        border-image: linear-gradient(90deg, #667eea, #764ba2) 1;
        padding-bottom: 15px;
      }
      .preview-content {
        min-height: 600px;
        border: 2px dashed rgba(102, 126, 234, 0.2);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #718096;
        font-style: italic;
        text-align: center;
        position: relative;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(10px);
        transition: 0.3s;
      }
      .preview-content:hover {
        border-color: rgba(102, 126, 234, 0.4);
        background: rgba(255, 255, 255, 0.7);
      }
      .preview-iframe {
        width: 100%;
        height: 600px;
        border: none;
        border-radius: 16px;
        background: white;
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
      }
      .preview-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      .preview-url {
        margin-top: 20px;
        padding: 15px 20px;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.05) 0%,
          rgba(118, 75, 162, 0.05) 100%
        );
        border-radius: 16px;
        font-size: 13px;
        word-break: break-all;
        border: 1px solid rgba(102, 126, 234, 0.1);
        backdrop-filter: blur(10px);
      }
      .preview-controls {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .preview-btn {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 500;
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        color: #4a5568;
      }
      .preview-btn:hover {
        background: rgba(102, 126, 234, 0.1);
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px -8px rgba(102, 126, 234, 0.3);
      }
      .preview-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        box-shadow: 0 8px 20px -8px rgba(102, 126, 234, 0.4);
        transform: translateY(-2px);
      }

      @media (max-width: 1024px) {
        .main-container {
          flex-direction: column;
          align-items: center;
          gap: 20px;
          padding: 15px;
        }
        .left-panel,
        .right-panel {
          width: 100%;
          max-width: 100%;
          position: static;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- Left Panel — Flash Cards (ORDER: Image → Prompt → GitHub) -->
      <div class="left-panel">
        <div class="flashcards-wrap">
          <!-- CARD 1: Generate from Restaurant Image (FIRST) -->
          <div class="flash-card container active" data-card="vision">
            <div class="card-header">
              <div class="card-title">📸 Generate from Restaurant Image</div>
              <button
                class="kebab"
                aria-label="More options"
                data-menu="menu-vision"
              >
                ⋮
              </button>
              <div class="menu" id="menu-vision">
                <button
                  type="button"
                  data-action="clear-form"
                  data-target="#form-vision"
                >
                  Clear form
                </button>
                <button
                  type="button"
                  data-action="copy-title"
                  data-text="Generate from Restaurant Image"
                >
                  Copy title
                </button>
              </div>
            </div>

            <form
              id="form-vision"
              method="POST"
              action="/"
              enctype="multipart/form-data"
            >
              <h2>📸 Generate from Restaurant Image</h2>
              <input type="file" name="image_file" accept="image/*" required />
              <br />
              <textarea
                class="large-textarea"
                name="image_prompt"
                placeholder="📝 Optional: Additional styling instructions (e.g., 'Use warm colors', 'Add elegant typography', 'Include reservation system')"
                rows="4"
              ></textarea>
              <br />
              <button type="submit">🍽️ Generate Restaurant Website</button>
            </form>

            {% if gpt_vision_response %}
            <div class="response-box gpt-vision-response">
              <strong>Restaurant Website:</strong><br />
              {{ gpt_vision_response }}
            </div>
            {% endif %}
          </div>

          <!-- CARD 2: AI Prompt to Website (SECOND) -->
          <div class="flash-card container" data-card="ai">
            <div class="card-header">
              <div class="card-title">🪄 AI Website Generator</div>
              <button
                class="kebab"
                aria-label="More options"
                data-menu="menu-ai"
              >
                ⋮
              </button>
              <div class="menu" id="menu-ai">
                <button
                  type="button"
                  data-action="clear-form"
                  data-target="#form-ai"
                >
                  Clear form
                </button>
                <button
                  type="button"
                  data-action="copy-title"
                  data-text="AI Website Generator"
                >
                  Copy title
                </button>
              </div>
            </div>

            <h1>🚀 AI Website Generator & Deployer</h1>
            <form id="form-ai" method="POST" action="/">
              <h2>✨ AI Text Prompt</h2>
              <textarea
                name="ai_prompt"
                placeholder="🎨 Describe your dream website... (e.g., 'Create a modern portfolio for a photographer with dark theme and gallery')"
                rows="4"
              ></textarea>
              <br />
              <button type="submit">🪄 Generate Website</button>
            </form>

            {% if ai_response %}
            <div class="response-box ai-response">
              <strong>AI Response:</strong><br />
              {{ ai_response }}
            </div>
            {% endif %}
          </div>

          <!-- CARD 3: Deploy from GitHub (THIRD) -->
          <div class="flash-card container" data-card="github">
            <div class="card-header">
              <div class="card-title">🐙 Deploy from GitHub</div>
              <button
                class="kebab"
                aria-label="More options"
                data-menu="menu-github"
              >
                ⋮
              </button>
              <div class="menu" id="menu-github">
                <button
                  type="button"
                  data-action="clear-form"
                  data-target="#form-github"
                >
                  Clear form
                </button>
                <button
                  type="button"
                  data-action="copy-title"
                  data-text="Deploy from GitHub"
                >
                  Copy title
                </button>
              </div>
            </div>

            <form id="form-github" method="POST" action="/">
              <h2>🐙 Deploy from GitHub</h2>
              <input
                type="text"
                name="github_url"
                placeholder="🔗 GitHub repository URL or individual HTML file URL"
              />
              <br />
              <small
                style="
                  color: #718096;
                  font-size: 13px;
                  line-height: 1.4;
                  display: block;
                  margin-bottom: 15px;
                "
              >
                💡 Supports both repository URLs and individual HTML file
                URLs<br />
                🚀 Automatically provisions Azure VM and deploys your code
              </small>
              <br />
              <button type="submit">🌐 Deploy to Cloud</button>
            </form>

            <form method="POST" action="/destroy">
              <button
                type="submit"
                style="
                  background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
                  box-shadow: 0 10px 25px -10px rgba(245, 101, 101, 0.4);
                "
              >
                🗑️ Destroy VM
              </button>
            </form>

            {% if message %}
            <p>{{ message }}</p>
            {% endif %}
          </div>

          <!-- Deck controls -->
          <div class="deck-controls">
            <button class="deck-btn" type="button" id="next-btn">
              🔍 More Options
            </button>
          </div>

          <small
            style="
              display: block;
              margin-top: 10px;
              color: #334155;
              opacity: 0.8;
            "
          >
            Tip: Use ← / → to switch cards.
          </small>
        </div>

        <!-- Quick Deploy & VM Status Box -->
        <div
          class="container"
          style="margin-top: 20px; border-left: 4px solid #667eea"
        >
          <h2>🚀 Quick Deploy & VM Status</h2>

          <!-- Quick Deploy Buttons -->
          {% if ai_response and "View at:" in ai_response %} {% set url_parts =
          ai_response.split("View at:") %} {% if url_parts|length > 1 %}
          <div class="quick-deploy">
            <strong>✨ AI Generated Site:</strong>
            <form
              method="POST"
              action="/"
              style="display: inline-block; margin-top: 10px"
            >
              <input
                type="hidden"
                name="github_url"
                value="{{ url_parts[1].strip() }}"
              />
              <button type="submit" class="inline-button">
                🚀 Deploy AI Site
              </button>
            </form>
          </div>
          {% endif %} {% endif %} {% if gpt_vision_response and "View at:" in
          gpt_vision_response %} {% set url_parts =
          gpt_vision_response.split("View at:") %} {% if url_parts|length > 1 %}
          <div class="quick-deploy">
            <strong>🍽️ Restaurant Site:</strong>
            <form
              method="POST"
              action="/"
              style="display: inline-block; margin-top: 10px"
            >
              <input
                type="hidden"
                name="github_url"
                value="{{ url_parts[1].strip() }}"
              />
              <button type="submit" class="inline-button">
                🚀 Deploy Restaurant Site
              </button>
            </form>
          </div>
          {% endif %} {% endif %}

          <!-- VM Status -->
          {% if vm_ip %}
          <div
            style="
              margin: 20px 0;
              padding: 20px;
              background: linear-gradient(
                135deg,
                rgba(72, 187, 120, 0.1) 0%,
                rgba(56, 161, 105, 0.1) 100%
              );
              border-radius: 16px;
              border: 1px solid rgba(72, 187, 120, 0.2);
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
                font-weight: 600;
                color: #2f855a;
              "
            >
              <span
                style="
                  width: 12px;
                  height: 12px;
                  border-radius: 50%;
                  background: #48bb78;
                  animation: pulse 2s infinite;
                "
              ></span>
              <strong>VM Live & Running</strong>
            </div>
            <div>
              <a
                href="http://{{ vm_ip }}"
                target="_blank"
                style="
                  display: inline-block;
                  padding: 10px 16px;
                  background: rgba(255, 255, 255, 0.8);
                  border: 2px solid rgba(72, 187, 120, 0.3);
                  border-radius: 12px;
                  color: #2f855a;
                  text-decoration: none;
                  font-weight: 600;
                  transition: all 0.3s ease;
                  backdrop-filter: blur(10px);
                "
              >
                🌐 http://{{ vm_ip }}
              </a>
            </div>
          </div>
          {% endif %}

          <!-- VM Controls -->
          {% if vm_ip %}
          <form method="POST" action="/destroy" style="margin-top: 15px">
            <button
              type="submit"
              style="
                background: linear-gradient(
                  135deg,
                  #f56565 0%,
                  #e53e3e 100%
                ) !important;
                box-shadow: 0 10px 25px -10px rgba(245, 101, 101, 0.4) !important;
              "
            >
              🗑️ Destroy VM
            </button>
          </form>
          {% endif %}

          <!-- Messages -->
          {% if message %}
          <div
            style="
              margin-top: 15px;
              padding: 15px;
              background: rgba(102, 126, 234, 0.05);
              border-radius: 12px;
              border-left: 4px solid #667eea;
            "
          >
            <p style="margin: 0">{{ message }}</p>
          </div>
          {% endif %}

          <!-- Show instructions when no deployments are available -->
          {% if not ai_response and not gpt_vision_response and not vm_ip %}
          <div
            style="
              padding: 20px;
              text-align: center;
              color: #718096;
              font-style: italic;
            "
          >
            <div style="font-size: 24px; margin-bottom: 10px">📋</div>
            <p style="margin: 0">
              Generate a website above to see Quick Deploy options here.
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Right Panel — Preview (unchanged) -->
      <div class="right-panel">
        <div class="preview-title">🖥️ Website Preview</div>

        {% if vm_ip or (ai_response and "View at:" in ai_response) or
        (gpt_vision_response and "View at:" in gpt_vision_response) %} {% set
        preview_url = vm_ip %} {% if ai_response and "View at:" in ai_response
        %} {% set url_parts = ai_response.split("View at:") %} {% if
        url_parts|length > 1 %} {% set github_url = url_parts[1].strip() %} {%
        set preview_url = "https://htmlpreview.github.io/?" + github_url %} {%
        endif %} {% endif %} {% if gpt_vision_response and "View at:" in
        gpt_vision_response %} {% set url_parts =
        gpt_vision_response.split("View at:") %} {% if url_parts|length > 1 %}
        {% set github_url = url_parts[1].strip() %} {% set preview_url =
        "https://htmlpreview.github.io/?" + github_url %} {% endif %} {% endif
        %}

        <div class="preview-controls">
          <button class="preview-btn active" onclick="switchPreview('desktop')">
            🖥️ Desktop
          </button>
          <button class="preview-btn" onclick="switchPreview('tablet')">
            📱 Tablet
          </button>
          <button class="preview-btn" onclick="switchPreview('mobile')">
            📱 Mobile
          </button>
        </div>

        <div class="preview-content" id="preview-container">
          <iframe
            id="preview-iframe"
            class="preview-iframe"
            src="{{ preview_url }}"
            onload="hideLoading()"
            onerror="showPreviewError()"
          ></iframe>
          <div class="preview-loading" id="preview-loading">
            <div>Loading preview...</div>
          </div>
        </div>

        {% if preview_url %}
        <div class="preview-url">
          <strong>Preview URL:</strong><br />
          <a href="{{ preview_url }}" target="_blank">{{ preview_url }}</a>
        </div>
        {% endif %} {% else %}
        <div class="preview-content">
          <div style="text-align: center; padding: 40px 20px">
            <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.6">
              🎨
            </div>
            <div
              style="
                font-size: 18px;
                color: #4a5568;
                margin-bottom: 10px;
                font-weight: 500;
              "
            >
              Preview will appear here when you generate or deploy a website
            </div>
            <small style="color: #718096; line-height: 1.5">
              📱 On mobile devices, this preview will appear below the
              controls.<br />
              ✨ Your generated websites will display with responsive design
              controls.
            </small>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <script>
      // ---------- Flashcards (buttons + arrow keys only) ----------
      const cards = Array.from(document.querySelectorAll(".flash-card"));
      let idx = cards.findIndex((c) => c.classList.contains("active"));
      if (idx < 0) idx = 0;
      function showCard(i) {
        cards.forEach((c, k) => c.classList.toggle("active", k === i));
      }
      function next() {
        idx = (idx + 1) % cards.length;
        showCard(idx);
      }
      function prev() {
        idx = (idx - 1 + cards.length) % cards.length;
        showCard(idx);
      }

      document.getElementById("next-btn").addEventListener("click", next);

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") next();
        if (e.key === "ArrowLeft") prev();
      });

      // ---------- Kebab menus ----------
      document.querySelectorAll(".kebab").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          const menuId = btn.getAttribute("data-menu");
          const menu = document.getElementById(menuId);
          document.querySelectorAll(".menu").forEach((m) => {
            if (m !== menu) m.classList.remove("open");
          });
          menu.classList.toggle("open");
        });
      });
      document.addEventListener("click", () =>
        document
          .querySelectorAll(".menu")
          .forEach((m) => m.classList.remove("open"))
      );

      // Menu actions
      document.querySelectorAll(".menu button").forEach((item) => {
        item.addEventListener("click", () => {
          const action = item.getAttribute("data-action");
          if (action === "clear-form") {
            const target = item.getAttribute("data-target");
            const form = document.querySelector(target);
            if (form) {
              form.reset();
              form.querySelectorAll("textarea").forEach((t) => (t.value = ""));
              form
                .querySelectorAll('input[type="text"]')
                .forEach((t) => (t.value = ""));
              form.querySelectorAll('input[type="file"]').forEach((f) => {
                f.value = "";
              });
            }
          }
          if (action === "copy-title") {
            const text = item.getAttribute("data-text") || document.title;
            navigator.clipboard.writeText(text).catch(() => {});
          }
          document
            .querySelectorAll(".menu")
            .forEach((m) => m.classList.remove("open"));
        });
      });

      // ---------- Preview sizing (unchanged) ----------
      function switchPreview(size) {
        const iframe = document.getElementById("preview-iframe");
        const buttons = document.querySelectorAll(".preview-btn");
        buttons.forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        iframe.style.margin = "0";
        iframe.style.display = "block";
        switch (size) {
          case "desktop":
            iframe.style.width = "100%";
            iframe.style.height = "600px";
            break;
          case "tablet":
            iframe.style.width = "768px";
            iframe.style.height = "600px";
            iframe.style.margin = "0 auto";
            break;
          case "mobile":
            iframe.style.width = "375px";
            iframe.style.height = "600px";
            iframe.style.margin = "0 auto";
            break;
        }
      }
      window.switchPreview = switchPreview;

      function hideLoading() {
        const loading = document.getElementById("preview-loading");
        if (loading) loading.style.display = "none";
      }
      window.hideLoading = hideLoading;

      function showPreviewError() {
        const container = document.getElementById("preview-container");
        const iframe = document.getElementById("preview-iframe");
        if (container && iframe) {
          container.innerHTML = `
            <div style="padding: 40px; text-align: center; color: #666;">
              <h3>Preview Not Available</h3>
              <p>GitHub HTML files cannot be previewed directly in iframe.</p>
              <br>
              <a href="${iframe.src}" target="_blank" 
                 style="background: #4a90e2; color: white; padding: 12px 24px; 
                        text-decoration: none; border-radius: 8px; display: inline-block;">
                🚀 View Full Website →
              </a>
              <br><br>
              <small style="color: #999;">
                The website is working perfectly - just click above to view it!
              </small>
            </div>
          `;
        }
      }
      window.showPreviewError = showPreviewError;

      const iframe = document.getElementById("preview-iframe");
      if (iframe && iframe.src) {
        setTimeout(() => {
          try {
            if (!iframe.contentDocument && !iframe.contentWindow)
              showPreviewError();
          } catch {
            console.log("Cross-origin iframe detected");
          }
        }, 5000);
        setInterval(() => {
          iframe.src = iframe.src;
        }, 30000);
      }
    </script>
  </body>
</html>
